{
  "hash": "700ec789f27c02d42cad2b26a3450c70",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Ordinal regression: final models\"\nformat: html\nauthor: \"Hannah Wilkie\"\nexecute:\n  warning: false\n---\n\n\n\nIn the previous post, the step() function output the following models:\n\n-   Fictional story: polr(formula = Fictional_story \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Abstract shapes: polr(formula = Abstract_shapes \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Sensory sensations: polr(formula = Sensory_sensations \\~ 1, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Life experiences: polr(formula = Life_experiences \\~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Media: polr(formula = Media \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Music: polr(formula = Music \\~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Future plans: polr(formula = Future_plans \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Building: polr(formula = Building \\~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Everyday: polr(formula = Everyday \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\nLet's run these models now, plot them, and have a closer look at the results.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(performance)\nlibrary(ordinal)\nlibrary(car)\nlibrary(ggeffects)\nlibrary(gofcat) \nlibrary(brms)\nlibrary(emmeans)\nlibrary(knitr)\nlibrary(MASS)\nlibrary(patchwork)\nlibrary(grid)\nlibrary(gridExtra)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- read_csv(\"https://raw.githubusercontent.com/hw3446/Final_Project_PUC/main/posts/Dataset_overview/working_data/data.csv\")\n\ndata2 <- read_csv(\"https://raw.githubusercontent.com/hw3446/Final_Project_PUC/main/posts/Dataset_overview/working_data/data2.csv\")\n```\n:::\n\n\n\nFirst some data tidying and treatment of N/As (as in last post).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcome_vars <- c(\"Fictional_story\", \"Abstract_shapes\", \"Sensory_sensations\", \n                  \"Life_experiences\", \"Media\", \"Music\", \"Future_plans\", \n                  \"Building\", \"Everyday\")\n\n# Converting outcome variables to factors with consistent levels for each thought type\ndata1[outcome_vars] <- lapply(data1[outcome_vars], factor, \n                             levels = c(\"Not at all\", \"A small amount of the time\", \n                                        \"A moderate amount of the time\", \"Most of the time\", \n                                        \"All of the time\"))\n\ndata2[outcome_vars] <- lapply(data2[outcome_vars], factor, \n                             levels = c(\"Not at all\", \"A small amount of the time\", \n                                        \"A moderate amount of the time\", \"Most of the time\", \n                                        \"All of the time\"))\n\n#Remaking the floor variable\ndata1 <- data1 %>%\n  mutate(Floor = ifelse(Location %in% c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\"), \"Downstairs\", \"Upstairs\")) %>% relocate(Floor, .after = Location)\n\ndata2 <- data2 %>%\n  mutate(Floor = ifelse(Location %in% c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\"), \"Downstairs\", \"Upstairs\")) %>% relocate(Floor, .after = Location)\n\n#Making sure demographic variables are classed in the right way.\ndata1$Age <- as.numeric(data1$Age)\ndata2$Age <- as.numeric(data2$Age)\ndata1$Practice <- as.numeric(as.character(data1$Practice))\ndata2$Practice <- as.numeric(as.character(data2$Practice))\ndata1$Gender <- factor(data1$Gender,  levels = c('Male', 'Female', 'Other'))\ndata2$Gender <- factor(data2$Gender,  levels = c('Male', 'Female', 'Other'))\ndata1$Music_listening <- factor(data1$Music_listening, levels = c('Very rarely', 'Somewhat rarely', 'Moderately frequently', 'Frequently', 'Very frequently'))\ndata2$Music_listening <- factor(data2$Music_listening, levels = c('Very rarely', 'Somewhat rarely', 'Moderately frequently', 'Frequently', 'Very frequently'))\ndata1$Floor <- factor(data1$Floor, levels = c('Downstairs', 'Upstairs'))\ndata2$Floor <- factor(data2$Floor, levels = c('Downstairs', 'Upstairs'))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mice)\nimputed_data1 <- mice(data1, m = 5, method = 'pmm', seed = 123, print = FALSE)\ncompleted_data1 <- complete(imputed_data1, 1)\n```\n:::\n\n\n\nRunning the models:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsenses <- polr(formula = Sensory_sensations ~ 1, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n\nmusic <- polr(formula = Music ~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n\nbuilding <- polr(formula = Building ~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\nlife <- polr(formula = Life_experiences ~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n```\n:::\n\n\n\nMany of the models select age as the strongest predictor. Let's plot them using a loop.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcome_age <- c(\"Fictional_story\", \"Abstract_shapes\",\n                  \"Media\", \"Future_plans\", \n                   \"Everyday\")\n\nplot_list <- list()\nfor (outcome in outcome_age) {\nmodel <- polr(as.formula(paste(outcome, \"~ Age\")), data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npredicted_probs <- ggemmeans(model, terms = c(\"Age\"))\n  \nplot <- ggplot(predicted_probs, aes(x = x, y = predicted, fill = response.level)) +\n    geom_area() + \n    labs(x = \"\\nAge (years)\", y = \"Predicted Probability\\n\", \n         title = paste(outcome, \"by Age\")) +\n    scale_fill_manual(\n      name = NULL,\n      values = setNames(c(\"#deebf7\", \"#9ecae1\", \"#3182bd\", \"#08519c\", \"#08306b\"), \n                      levels(completed_data1[[outcome]])),\n      labels = c(\"Not at all\", \"A small amount of the time\", \"A moderate amount of the time\", \n                 \"Most of the time\", \"All of the time\"),\n      breaks = c(\"Not at all\", \"A small amount of the time\", \"A moderate amount of the time\", \n                 \"Most of the time\", \"All of the time\")\n    ) + \n    theme_minimal()\n  \n\n  plot_list[[outcome]] <- plot\n}\n\ntitle_grob <- textGrob(\"Types of Thoughts by Age, First Half\", gp = gpar(fontsize = 16, fontface = \"bold\"))\n\nAge_thoughts_models <- grid.arrange(\n  grobs = plot_list, \n  ncol = 3, \n  top = title_grob  \n)\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-6-1.png){width=1728}\n:::\n:::\n\n\n\nLet's now tackle the plots with multiple predictors.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresponse_levels <- c(\"Not at all\", \"A small amount of the time\", \"A moderate amount of the time\",\n                     \"Most of the time\", \"All of the time\")\n\nfill_colors <- c(\"#deebf7\", \"#9ecae1\", \"#3182bd\", \"#08519c\", \"#08306b\")\nnames(fill_colors) <- response_levels\n\nmusic <- polr(formula = Music ~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npred_music <- ggemmeans(music, terms = c(\"Practice\", \"Music_listening\"))\n\nggplot(pred_music, aes(x = x, y = predicted, fill = response.level)) +\n     geom_area(alpha = 1) +\n     facet_wrap(~ group, scales = \"free_y\") +\n     labs(x = \"\\nPractice (years)\", y = \"Predicted Probability\\n\", title = \"Music by Practice, Faceted by Classical Music listening\") +\n     scale_fill_manual(name = NULL, values = fill_colors) +\n     theme_minimal() +\n     theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlife <- polr(formula = Life_experiences ~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npred_life <- ggemmeans(life, terms = c(\"Age\", \"Gender\"))\n\nggplot(pred_life, aes(x = x, y = predicted, fill = response.level)) +\n     geom_area(alpha = 1) +\n     facet_wrap(~ group, scales = \"free_y\") +  # Facet by Practice\n     labs(x = \"\\nAge (years)\", y = \"Predicted Probability\\n\", title = \"Life Experiences by Age, Faceted by Gender\") +\n     scale_fill_manual(name = NULL, values = fill_colors) +\n     theme_minimal() +\n     theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-8-1.png){width=864}\n:::\n:::\n\n\n\nThis plot shows probability of thinking about the building or space by age, faceted by floor and holding Gender + Music listening constant.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuilding <- polr(formula = Building ~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npred_building <- ggemmeans(building, terms = c(\"Age\", \"Floor\"))\n\nggplot(pred_building, aes(x = x, y = predicted, fill = response.level)) +\n     geom_area(alpha = 1) +\n     facet_wrap(~ group, scales = \"free_y\") +\n     labs(x = \"\\nAge (years)\", y = \"Predicted Probability\\n\", title = \"Building by Age, Faceted by Floor\") +\n     scale_fill_manual(name = NULL, values = fill_colors) +\n     theme_minimal() +\n     theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n\n\nLet's do a little brant test:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nlibrary(brant)\n\nmodels <- list(\n  fiction = polr(Fictional_story ~ Age, data = completed_data1, method = \"logistic\", Hess = TRUE),\n  abstract = polr(Abstract_shapes ~ Age, data = completed_data1, method = \"logistic\", Hess = TRUE),\nsense = polr(formula = Sensory_sensations ~ 1, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\"),\nlife = polr(formula = Life_experiences ~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\"),\nmedia = polr(formula = Media ~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\"),\nmusic = polr(formula = Music ~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\"),\nfuture = polr(formula = Future_plans ~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\"),\nbuilding = polr(formula = Building ~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\"),\neveryday = polr(formula = Everyday ~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n)\n\nlapply(models, function(model) {\n  tryCatch({\n    brant.test(model)\n  }, error = function(e) {\n    message(\"Error in model: \", conditionMessage(e))\n    return(NULL)\n  })\n})\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$fiction\n\nBrant Test:\n           chi-sq   df   pr(>chi)  \nOmnibus      6.66    3      0.083 .\nAge          6.66    3      0.083 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nH0: Proportional odds assumption holds\n\n\n$abstract\n\nBrant Test:\n           chi-sq   df   pr(>chi)\nOmnibus      2.16    3       0.54\nAge          2.16    3       0.54\n\nH0: Proportional odds assumption holds\n\n\n$sense\nNULL\n\n$life\n\nBrant Test:\n                chi-sq   df   pr(>chi)\nOmnibus          5.620    9       0.78\nAge              0.628    3       0.89\nGenderFemale     4.736    3       0.19\nGenderOther      0.000    3       1.00\n\nH0: Proportional odds assumption holds\n\n\n$media\n\nBrant Test:\n           chi-sq   df   pr(>chi)\nOmnibus      3.12    2       0.21\nAge          3.12    2       0.21\n\nH0: Proportional odds assumption holds\n\n\n$music\n\nBrant Test:\n                                        chi-sq   df   pr(>chi)\nOmnibus                                  10.45   15       0.79\nMusic_listeningSomewhat rarely            0.00    3       1.00\nMusic_listeningModerately frequently      0.00    3       1.00\nMusic_listeningFrequently                 0.00    3       1.00\nMusic_listeningVery frequently            0.00    3       1.00\nPractice                                  1.49    3       0.69\n\nH0: Proportional odds assumption holds\n\n\n$future\n\nBrant Test:\n           chi-sq   df   pr(>chi)\nOmnibus      0.68    3       0.88\nAge          0.68    3       0.88\n\nH0: Proportional odds assumption holds\n\n\n$building\n\nBrant Test:\n                                        chi-sq   df   pr(>chi)\nOmnibus                                 13.502   24       0.96\nAge                                      4.631    3       0.20\nGenderFemale                             0.957    3       0.81\nGenderOther                              0.000    3       1.00\nMusic_listeningSomewhat rarely           0.000    3       1.00\nMusic_listeningModerately frequently     0.000    3       1.00\nMusic_listeningFrequently                0.000    3       1.00\nMusic_listeningVery frequently           0.000    3       1.00\nFloorUpstairs                            2.299    3       0.51\n\nH0: Proportional odds assumption holds\n\n\n$everyday\n\nBrant Test:\n           chi-sq   df   pr(>chi)\nOmnibus      4.66    3        0.2\nAge          4.66    3        0.2\n\nH0: Proportional odds assumption holds\n```\n\n\n:::\n:::\n\n\n\nAnd a summary of the latent coefficients with p values:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the necessary library\nlibrary(tibble)\nlibrary(dplyr)\n\n# Initialize an empty list to store the results\nall_results <- tibble()\n\n# Loop through each model in the list\nfor (model_name in names(models)) {\n  cat(\"\\nProcessing\", model_name, \"model:\\n\")\n  model <- models[[model_name]]\n  \n  # Get the summary\n  model_summary <- summary(model)\n  \n  # Extract coefficients table\n  coef_table <- model_summary$coefficients\n  \n  # Calculate t-values and p-values\n  t_values <- coef_table[, \"Value\"] / coef_table[, \"Std. Error\"]\n  p_values <- 2 * (1 - pnorm(abs(t_values)))\n  \n  # Create a tibble for the current model's results\n  model_results <- tibble(\n    Model = model_name,  # Name of the model\n    Term = rownames(coef_table),  # Term names (e.g., intercept, Age)\n    Estimate = coef_table[, \"Value\"],\n    `Std. Error` = coef_table[, \"Std. Error\"],\n    `t value` = t_values,\n    `p value` = p_values\n  )\n  \n  # Bind the current model's results to the all_results tibble\n  all_results <- bind_rows(all_results, model_results)\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nProcessing fiction model:\n\nProcessing abstract model:\n\nProcessing sense model:\n\nProcessing life model:\n\nProcessing media model:\n\nProcessing music model:\n\nProcessing future model:\n\nProcessing building model:\n\nProcessing everyday model:\n```\n\n\n:::\n\n```{.r .cell-code}\n# Print the combined data frame with results for all models\nprint(all_results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 57 × 6\n   Model    Term                       Estimate `Std. Error` `t value` `p value`\n   <chr>    <chr>                         <dbl>        <dbl>     <dbl>     <dbl>\n 1 fiction  Age                         -0.0181      0.00701     -2.58 0.00978  \n 2 fiction  Not at all|A small amount…  -1.46        0.434       -3.37 0.000756 \n 3 fiction  A small amount of the tim…  -0.483       0.418       -1.16 0.248    \n 4 fiction  A moderate amount of the …   0.462       0.427        1.08 0.279    \n 5 fiction  Most of the time|All of t…   2.50        0.588        4.25 0.0000211\n 6 abstract Age                         -0.0131      0.00737     -1.77 0.0766   \n 7 abstract Not at all|A small amount…  -0.521       0.446       -1.17 0.243    \n 8 abstract A small amount of the tim…   0.579       0.446        1.30 0.194    \n 9 abstract A moderate amount of the …   1.94        0.506        3.84 0.000124 \n10 abstract Most of the time|All of t…   4.40        1.08         4.08 0.0000456\n# ℹ 47 more rows\n```\n\n\n:::\n:::\n",
    "supporting": [
      "Modelling_3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}