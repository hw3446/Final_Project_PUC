{
  "hash": "5a75962995a48ccafe6afa557a08e8c5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Ordinal regression: final models\"\nformat: html\nauthor: \"Hannah Wilkie\"\nexecute:\n  warning: false\n---\n\n\n\nIn the previous post, the step() function output the following models:\n\n-   Fictional story: polr(formula = Fictional_story \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Abstract shapes: polr(formula = Abstract_shapes \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Sensory sensations: polr(formula = Sensory_sensations \\~ 1, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Life experiences: polr(formula = Life_experiences \\~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Media: polr(formula = Media \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Music: polr(formula = Music \\~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Future plans: polr(formula = Future_plans \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Building: polr(formula = Building \\~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n-   Everyday: polr(formula = Everyday \\~ Age, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\nLet's run these models now, plot them, and have a closer look at the results.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(performance)\nlibrary(ordinal)\nlibrary(car)\nlibrary(ggeffects)\nlibrary(gofcat) \nlibrary(brms)\nlibrary(emmeans)\nlibrary(knitr)\nlibrary(MASS)\nlibrary(patchwork)\nlibrary(grid)\nlibrary(gridExtra)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- read_csv(\"https://raw.githubusercontent.com/hw3446/Final_Project_PUC/main/posts/Dataset_overview/working_data/data.csv\")\n\ndata2 <- read_csv(\"https://raw.githubusercontent.com/hw3446/Final_Project_PUC/main/posts/Dataset_overview/working_data/data2.csv\")\n```\n:::\n\n\n\nFirst some data tidying and treatment of N/As (as in last post).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcome_vars <- c(\"Fictional_story\", \"Abstract_shapes\", \"Sensory_sensations\", \n                  \"Life_experiences\", \"Media\", \"Music\", \"Future_plans\", \n                  \"Building\", \"Everyday\")\n\n# Converting outcome variables to factors with consistent levels for each thought type\ndata1[outcome_vars] <- lapply(data1[outcome_vars], factor, \n                             levels = c(\"Not at all\", \"A small amount of the time\", \n                                        \"A moderate amount of the time\", \"Most of the time\", \n                                        \"All of the time\"))\n\ndata2[outcome_vars] <- lapply(data2[outcome_vars], factor, \n                             levels = c(\"Not at all\", \"A small amount of the time\", \n                                        \"A moderate amount of the time\", \"Most of the time\", \n                                        \"All of the time\"))\n\n#Remaking the floor variable\ndata1 <- data1 %>%\n  mutate(Floor = ifelse(Location %in% c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\"), \"Downstairs\", \"Upstairs\")) %>% relocate(Floor, .after = Location)\n\ndata2 <- data2 %>%\n  mutate(Floor = ifelse(Location %in% c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\"), \"Downstairs\", \"Upstairs\")) %>% relocate(Floor, .after = Location)\n\n#Making sure demographic variables are classed in the right way.\ndata1$Age <- as.numeric(data1$Age)\ndata2$Age <- as.numeric(data2$Age)\ndata1$Practice <- as.numeric(as.character(data1$Practice))\ndata2$Practice <- as.numeric(as.character(data2$Practice))\ndata1$Gender <- factor(data1$Gender,  levels = c('Male', 'Female', 'Other'))\ndata2$Gender <- factor(data2$Gender,  levels = c('Male', 'Female', 'Other'))\ndata1$Music_listening <- factor(data1$Music_listening, levels = c('Very rarely', 'Somewhat rarely', 'Moderately frequently', 'Frequently', 'Very frequently'))\ndata2$Music_listening <- factor(data2$Music_listening, levels = c('Very rarely', 'Somewhat rarely', 'Moderately frequently', 'Frequently', 'Very frequently'))\ndata1$Floor <- factor(data1$Floor, levels = c('Downstairs', 'Upstairs'))\ndata2$Floor <- factor(data2$Floor, levels = c('Downstairs', 'Upstairs'))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mice)\nimputed_data1 <- mice(data1, m = 5, method = 'pmm', seed = 123, print = FALSE)\ncompleted_data1 <- complete(imputed_data1, 1)\n```\n:::\n\n\n\nRunning the models:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsenses <- polr(formula = Sensory_sensations ~ 1, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n\nmusic <- polr(formula = Music ~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\n\nbuilding <- polr(formula = Building ~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\nlife <- polr(formula = Life_experiences ~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n```\n:::\n\n\n\nMany of the models select age as the strongest predictor. Let's plot them using a loop.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcome_age <- c(\"Fictional_story\", \"Abstract_shapes\",\n                  \"Media\", \"Future_plans\", \n                   \"Everyday\")\n\nplot_list <- list()\nfor (outcome in outcome_age) {\nmodel <- polr(as.formula(paste(outcome, \"~ Age\")), data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npredicted_probs <- ggemmeans(model, terms = c(\"Age\"))\n  \nplot <- ggplot(predicted_probs, aes(x = x, y = predicted, fill = response.level)) +\n    geom_area() + \n    labs(x = \"\\nAge\", y = \"Predicted Probability\\n\", \n         title = paste(outcome, \"by Age\")) +\n    scale_fill_manual(\n      name = NULL,\n      values = setNames(c(\"#deebf7\", \"#9ecae1\", \"#3182bd\", \"#08519c\", \"#08306b\"), \n                      levels(completed_data1[[outcome]])),\n      labels = c(\"Not at all\", \"A small amount of the time\", \"A moderate amount of the time\", \n                 \"Most of the time\", \"All of the time\"),\n      breaks = c(\"Not at all\", \"A small amount of the time\", \"A moderate amount of the time\", \n                 \"Most of the time\", \"All of the time\")\n    ) + \n    theme_minimal()\n  \n\n  plot_list[[outcome]] <- plot\n}\n\ntitle_grob <- textGrob(\"Types of Thoughts by Age, First Half\", gp = gpar(fontsize = 16, fontface = \"bold\"))\n\nAge_thoughts_models <- grid.arrange(\n  grobs = plot_list, \n  ncol = 3, \n  top = title_grob  \n)\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-6-1.png){width=1728}\n:::\n:::\n\n\n\nLet's now tackle the plots with multiple predictors.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresponse_levels <- c(\"Not at all\", \"A small amount of the time\", \"A moderate amount of the time\",\n                     \"Most of the time\", \"All of the time\")\n\nfill_colors <- c(\"#deebf7\", \"#9ecae1\", \"#3182bd\", \"#08519c\", \"#08306b\")\nnames(fill_colors) <- response_levels\n\nmusic <- polr(formula = Music ~ Music_listening + Practice, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npred_music <- ggemmeans(music, terms = c(\"Practice\", \"Music_listening\"))\n\nggplot(pred_music, aes(x = x, y = predicted, fill = response.level)) +\n     geom_area(alpha = 1) +\n     facet_wrap(~ group, scales = \"free_y\") +\n     labs(x = \"\\nPractice\", y = \"Predicted Probability\\n\", title = \"Music by Practice, Faceted by Classical Music listening\") +\n     scale_fill_manual(name = NULL, values = fill_colors) +\n     theme_minimal() +\n     theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlife <- polr(formula = Life_experiences ~ Age + Gender, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npred_life <- ggemmeans(life, terms = c(\"Age\", \"Gender\"))\n\nggplot(pred_life, aes(x = x, y = predicted, fill = response.level)) +\n     geom_area(alpha = 1) +\n     facet_wrap(~ group, scales = \"free_y\") +  # Facet by Practice\n     labs(x = \"\\nAge\", y = \"Predicted Probability\\n\", title = \"Life Experiences by Age, Faceted by Gender\") +\n     scale_fill_manual(name = NULL, values = fill_colors) +\n     theme_minimal() +\n     theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-8-1.png){width=864}\n:::\n:::\n\n\n\nThis plot shows probability of thinking about the building or space by age, faceted by floor and holding Gender + Music listening constant.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuilding <- polr(formula = Building ~ Age + Gender + Music_listening + Floor, data = completed_data1, control = list(maxit = 1000), na.action = na.exclude, Hess = TRUE, method = \"probit\")\n\npred_building <- ggemmeans(building, terms = c(\"Age\", \"Floor\"))\n\nggplot(pred_building, aes(x = x, y = predicted, fill = response.level)) +\n     geom_area(alpha = 1) +\n     facet_wrap(~ group, scales = \"free_y\") +\n     labs(x = \"\\nAge\", y = \"Predicted Probability\\n\", title = \"Building by Age, Faceted by Floor\") +\n     scale_fill_manual(name = NULL, values = fill_colors) +\n     theme_minimal() +\n     theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](Modelling_3_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n",
    "supporting": [
      "Modelling_3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}